---
layout: post
title: 'Woe-ARIA: The Surprisingly but Ridiculously Complicated World of aria-label/ledby'
date: '2015-12-17T16:31:00.001+10:00'
author: Jamie Teh
tags:
- accessibility
- web
modified_time: '2015-12-18T13:12:06.840+10:00'
blogger_id: tag:blogger.com,1999:blog-5419412965543098028.post-7634807056568165010
permalink: /2015/12/woe-aria-surprisingly-but-ridiculously.html
permalink: /2015/12/woe-aria-surprisingly-but-ridiculously.html
---

<div class="markdown-here-wrapper" data-md-url="https://www.blogger.com/blogger.g?blogID=5419412965543098028#editor/target=post;postID=7634807056568165010"><h4 id="introduction" style="font-size: 1.2em; font-weight: bold; margin: 1.3em 0px 1em; padding: 0px;">Introduction</h4><div style="margin: 0px 0px 1.2em ! important;"><a href="http://www.w3.org/TR/wai-aria/">WAI-ARIA</a> is one of the best  things ever to happen to web accessibility. It paved the way to free us  from a world where JavaScript and any widget that didn’t have an HTML  tag equated to inaccessibility. Aside from it being deployed by authors,  I’ve even managed to <a href="https://github.com/nvaccess/axSGrease">majorly improve the accessibility of various websites</a> using <a href="http://www.greasespot.net/">Greasemonkey</a> scripts. I love ARIA.</div><div style="margin: 0px 0px 1.2em ! important;">But sometimes, I hate ARIA. Yes, you heard me. I said it. Sometimes, it drives me truly insane.</div><div style="margin: 0px 0px 1.2em ! important;">Let’s take aria-label and aria-labelledby. They’re awesome. Authors can  just use them to make screen readers speak the right thing. Simple,  right?</div><div style="margin: 0px 0px 1.2em ! important;">Not at all. I wish it were that simple, but it is so, so much more complicated than that. I’ve <a href="https://lists.w3.org/Archives/Public/wai-xtech/2014Feb/0032.html">had</a> <a href="https://github.com/nvaccess/nvda/issues/5567">a</a> <a href="https://github.com/nvaccess/nvda/issues/5398">ridiculous</a> <a href="https://github.com/nvaccess/nvda/issues/5180">number</a> <a href="https://github.com/nvaccess/nvda/issues/4773">of</a> <a href="https://github.com/nvaccess/nvda/issues/3746">discussions</a>/<a href="https://twitter.com/jcsteh/status/669119759670087680">arguments</a> <a href="https://github.com/nvaccess/nvda/issues/3852">about</a> <a href="https://github.com/nvaccess/nvda/issues/3551">aria-label/aria-labelledby</a> <a href="https://github.com/nvaccess/nvda/issues/1362">over</a> <a href="https://github.com/nvaccess/nvda/issues/1354">the</a> <a href="https://github.com/nvaccess/nvda/issues/1195">years</a>.  Frankly, when I hear about aria-label/ledby, it just makes me cringe  and groan and, depending on the day, consider quitting my job. (Okay,  perhaps that last part is a bit melodramatic.)</div><div style="margin: 0px 0px 1.2em ! important;">The most frustrating part is that people frequently argue that assistive  technology products aren’t following the spec when their particular use  case doesn’t work as expected. Others bemoan the lack of  interoperability between AT products and often blame the AT vendors. But  actually, the ARIA spec and guidelines don’t say (not even in terms of  recommendations) anything about what ATs should do. They talk only about  what browsers should expose, and herein begins a great deal of  misunderstanding, argument and confusion. And when we do try to fix one  seemingly obvious use case, we often break another seemingly obvious use  case.</div><div style="margin: 0px 0px 1.2em ! important;">In this epic ramble, I’ll attempt to explain just how complicated this  supeficially trivial issue is, primarily so I can avoid having this  argument over and over and over again. While this is specifically  related to aria-label/aria-labelledby, it’s worth noting there are  similar cans of worms lurking in many other aspects of ARIA. Also, I  specifically discuss screen readers with a focus on NVDA in particular,  but some of this should still be relevant to other AT.</div><h4 id="why-not-just-use-the-accessible-name-" style="font-size: 1.2em; font-weight: bold; margin: 1.3em 0px 1em; padding: 0px;">Why not just use the accessible name?</h4><div style="margin: 0px 0px 1.2em ! important;">Essentially, aria-label/ledby alters what a browser exposes as the  “name” of an element via accessibility APIs. Furthermore, ARIA specifies  when the name should be calculated from the “text” of descendant  elements. So before we even get into aria-label/ledby, let’s address the  question: why don’t screen raeders just use the name wherever it is  present?</div><div style="margin: 0px 0px 1.2em ! important;">The major problem with this is that the “name” is just text. It doesn’t provide any semantic or formatting information.</div><div style="margin: 0px 0px 1.2em ! important;">Take this example:</div><pre style="font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; font-size: 1em; line-height: 1.2em; margin: 1.2em 0px;"><code style="background-color: #f8f8f8; border-radius: 3px; border-radius: 3px; border: 1px solid rgb(204, 204, 204); border: 1px solid rgb(234, 234, 234); display: block ! important; display: inline; font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; margin: 0px 0.15em; overflow: auto; padding: 0.5em 0.7em; padding: 0px 0.3em; white-space: pre-wrap; white-space: pre;">&lt;a href="foo"&gt;&lt;em&gt;bar&lt;/em&gt; bas&lt;/a&gt;<br /></code></pre><div style="margin: 0px 0px 1.2em ! important;">A browser will expose “bar bas” as the name of the link exactly as you  might expect. But that “bar bas” is just text. What about the fact that  “bar” was emphasised? If we just take the name, that information is  lost. In this example:</div><pre style="font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; font-size: 1em; line-height: 1.2em; margin: 1.2em 0px;"><code style="background-color: #f8f8f8; border-radius: 3px; border-radius: 3px; border: 1px solid rgb(204, 204, 204); border: 1px solid rgb(234, 234, 234); display: block ! important; display: inline; font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; margin: 0px 0.15em; overflow: auto; padding: 0.5em 0.7em; padding: 0px 0.3em; white-space: pre-wrap; white-space: pre;">&lt;a href="foo"&gt;&lt;img src="bar.png" alt="bar"&gt; bas&lt;/a&gt;<br /></code></pre><div style="margin: 0px 0px 1.2em ! important;">the name is again “bar bas”. But if we just take the name, the fact that “bar” is a graphic is lost.</div><div style="margin: 0px 0px 1.2em ! important;">These are overly simple, contrived examples, but imagine how this begins to matter once you have more complex content.</div><div style="margin: 0px 0px 1.2em ! important;">In short, content is more than just the name.</div><h4 id="just-use-it-when-aria-label-ledby-is-present-" style="font-size: 1.2em; font-weight: bold; margin: 1.3em 0px 1em; padding: 0px;">Just use it when aria-label/ledby is present.</h4><div style="margin: 0px 0px 1.2em ! important;">Okay. So we can’t always use the name. But if aria-label/ledby is present, then we can use the name, right?</div><div style="margin: 0px 0px 1.2em ! important;">Wrong. To disprove this, all we have to do is take a landmark:</div><pre style="font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; font-size: 1em; line-height: 1.2em; margin: 1.2em 0px;"><code style="background-color: #f8f8f8; border-radius: 3px; border-radius: 3px; border: 1px solid rgb(204, 204, 204); border: 1px solid rgb(234, 234, 234); display: block ! important; display: inline; font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; margin: 0px 0.15em; overflow: auto; padding: 0.5em 0.7em; padding: 0px 0.3em; white-space: pre-wrap; white-space: pre;">&lt;div role="navigation" aria-label="Main"&gt;Lots of navigation links here&lt;/div&gt;<br /></code></pre><div style="margin: 0px 0px 1.2em ! important;">Now, our screen reader comes along looking for content and sees there’s a  name, which it happily uses as the content for the entire element.  Oops. All of our navigation links just disappeared. All we have left is  “Main”. (Of course, no screen reader actually does or has ever done this as far as I'm aware.)</div><h4 id="that-s-just-silly-you-obviously-don-t-do-it-for-landmarks-" style="font-size: 1.2em; font-weight: bold; margin: 1.3em 0px 1em; padding: 0px;">That’s just silly. You obviously don’t do it for landmarks!</h4><div style="margin: 0px 0px 1.2em ! important;">Well, sure, but this raises the question: when do we use it and when  don’t we? “Common sense” isn’t sufficient for people, let alone  computers. We need clear, unambiguous rules. There is no document which  provides any such guidance for AT, so each product has to try to come up  with its own rules. And thus, the cracks in the mythical utopia of  interoperability begin to emerge.</div><div style="margin: 0px 0px 1.2em ! important;">That really sucks. But enough doom and gloom. Let’s try to come up with some rules here.</div><h4 id="render-aria-label-ledby-before-the-real-content-" style="font-size: 1.2em; font-weight: bold; margin: 1.3em 0px 1em; padding: 0px;">Render aria-label/ledby before the real content?</h4><div style="margin: 0px 0px 1.2em ! important;">Yup, this would fix the landmark case. It is bad for a case like this, though:</div><pre style="font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; font-size: 1em; line-height: 1.2em; margin: 1.2em 0px;"><code style="background-color: #f8f8f8; border-radius: 3px; border-radius: 3px; border: 1px solid rgb(204, 204, 204); border: 1px solid rgb(234, 234, 234); display: block ! important; display: inline; font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; margin: 0px 0.15em; overflow: auto; padding: 0.5em 0.7em; padding: 0px 0.3em; white-space: pre-wrap; white-space: pre;">&lt;button aria-label="Close"&gt;X&lt;/button&gt;<br /></code></pre><div style="margin: 0px 0px 1.2em ! important;">That “X” is meaningless semantically, so the author thoughtfully used  aria-label. If we use both the name and content, we’ll get “Close X”.  Yuck!</div><h4 id="landmarks-are-just-special-you-can-still-use-aria-label-ledby-as-content-for-everything-else-" style="font-size: 1.2em; font-weight: bold; margin: 1.3em 0px 1em; padding: 0px;">Landmarks are just special. You can still use aria-label/ledby as content for everything else.</h4><div style="margin: 0px 0px 1.2em ! important;">Not so much. Consider this tweet-like example:</div><pre style="font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; font-size: 1em; line-height: 1.2em; margin: 1.2em 0px;"><code style="background-color: #f8f8f8; border-radius: 3px; border-radius: 3px; border: 1px solid rgb(204, 204, 204); border: 1px solid rgb(234, 234, 234); display: block ! important; display: inline; font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; margin: 0px 0.15em; overflow: auto; padding: 0.5em 0.7em; padding: 0px 0.3em; white-space: pre-wrap; white-space: pre;">&lt;li tabindex="-1" aria-labelledby="user message time"&gt;<br />  &lt;a id="user" href="alice"&gt;@Alice&lt;/a&gt;<br />  &lt;a id="time" href="6min"&gt;6 minutes ago&lt;/a&gt;<br />  &lt;span id="message"&gt;Wow. This blog is horrible: &lt;a href="http://blog.jantrid.net/"&gt;http://blog.jantrid.net/&lt;/a&gt;&lt;/span&gt;<br />  &lt;a href="conv"&gt;View conversation&lt;/a&gt;<br />  &lt;button&gt;Reply&lt;/button&gt;<br />&lt;/li&gt;<br /></code></pre><div style="margin: 0px 0px 1.2em ! important;">Twitter.com uses this technique, though the code is obviously nothing  like this. The “li” element is the tweet. It’s focusable and you can  move between tweets by pressing j and k. The aria-labelledby means you  get a nice, efficient summary experience when navigating between tweets;  e.g. the time gets read last, the View conversation and Reply controls  are excluded, etc. But if we used the name as content, we’d lose the  formatting, links in the message, and the View conversation and Reply  controls. If we render the name before the content, we end up with  serious duplication.</div><h4 id="can-i-at-least-label-links-and-buttons-" style="font-size: 1.2em; font-weight: bold; margin: 1.3em 0px 1em; padding: 0px;">Can I at least label links and buttons?</h4><div style="margin: 0px 0px 1.2em ! important;">Believe it or not, I actually have good news this time: yes, you can.  But why links and buttons? And what else falls into this category? We  need a proper rule here, remember.</div><div style="margin: 0px 0px 1.2em ! important;">There are certain elements such as links, buttons, graphics, headings,  tabs and menu items where the content is always what makes sense as the  label. While it isn’t clear that it can be used for this determination,  the ARIA spec includes a characteristic of “Name From: contents”  which neatly categorises these controls.</div><div style="margin: 0px 0px 1.2em ! important;">Thus, we reach our first solid rule: if the ARIA characteristic “Name From: contents” applies, aria-label/ledby should completely override  the content.</div><h4 id="what-about-check-boxes-and-radio-buttons-" style="font-size: 1.2em; font-weight: bold; margin: 1.3em 0px 1em; padding: 0px;">What about check boxes and radio buttons?</h4><div style="margin: 0px 0px 1.2em ! important;">Check boxes and radio buttons don’t quite fit this rule. The problem is  that the label is often (but not always) presented separately from the  check box element itself, as is the case with the standard HTML input  tag:</div><pre style="font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; font-size: 1em; line-height: 1.2em; margin: 1.2em 0px;"><code style="background-color: #f8f8f8; border-radius: 3px; border-radius: 3px; border: 1px solid rgb(204, 204, 204); border: 1px solid rgb(234, 234, 234); display: block ! important; display: inline; font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; margin: 0px 0.15em; overflow: auto; padding: 0.5em 0.7em; padding: 0px 0.3em; white-space: pre-wrap; white-space: pre;">&lt;input id="Cheese" type="checkbox"&gt;&lt;label for="cheese"&gt;Cheese&lt;/label&gt;<br /></code></pre><div style="margin: 0px 0px 1.2em ! important;">The equivalent using ARIA would be:</div><pre style="font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; font-size: 1em; line-height: 1.2em; margin: 1.2em 0px;"><code style="background-color: #f8f8f8; border-radius: 3px; border-radius: 3px; border: 1px solid rgb(204, 204, 204); border: 1px solid rgb(234, 234, 234); display: block ! important; display: inline; font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; margin: 0px 0.15em; overflow: auto; padding: 0.5em 0.7em; padding: 0px 0.3em; white-space: pre-wrap; white-space: pre;">&lt;div role="checkbox" aria-labelledby="cheeseLabel"&gt;&amp;nbsp;&lt;/div&gt;&lt;div id="cheeseLabel"&gt;Cheese&lt;/div&gt;<br /></code></pre><div style="margin: 0px 0px 1.2em ! important;">In most cases, a screen reader will see both the check box and label  elements separately. If we say the name should always be rendered for  check boxes, we’ll end up with double cheese: the first instance will be  the name of the check box, with the second being the label element  itself. Duplication is evil, primarily because it causes excessive  verbosity.</div><div style="margin: 0px 0px 1.2em ! important;">Okay, so we choose one of them. But which one?</div><h4 id="ignore-the-label-element-obviously-duh-" style="font-size: 1.2em; font-weight: bold; margin: 1.3em 0px 1em; padding: 0px;">Ignore the label element, obviously. Duh.</h4><div style="margin: 0px 0px 1.2em ! important;">Perhaps. In fact, WebKit and derivatives choose to strip out the label  element altogether as far as accessibility is concerned in some cases.  But what about the formatting and other semantic info?</div><div style="margin: 0px 0px 1.2em ! important;">Let’s try this example in Google Chrome, which has its roots in WebKit:</div><pre style="font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; font-size: 1em; line-height: 1.2em; margin: 1.2em 0px;"><code style="background-color: #f8f8f8; border-radius: 3px; border-radius: 3px; border: 1px solid rgb(204, 204, 204); border: 1px solid rgb(234, 234, 234); display: block ! important; display: inline; font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; margin: 0px 0.15em; overflow: auto; padding: 0.5em 0.7em; padding: 0px 0.3em; white-space: pre-wrap; white-space: pre;">&lt;input type="checkbox" id="agree"&gt;&lt;label for="agree"&gt;I agree to the &lt;a href="terms"&gt;terms and conditions&lt;/a&gt;&lt;/label&gt;<br /></code></pre><div style="margin: 0px 0px 1.2em ! important;">The label element gets stripped out, leaving a check box and a link. If I read this in NVDA browse mode, I get:</div><pre style="font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; font-size: 1em; line-height: 1.2em; margin: 1.2em 0px;"><code style="background-color: #f8f8f8; border-radius: 3px; border-radius: 3px; border: 1px solid rgb(204, 204, 204); border: 1px solid rgb(234, 234, 234); display: block ! important; display: inline; font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; margin: 0px 0.15em; overflow: auto; padding: 0.5em 0.7em; padding: 0px 0.3em; white-space: pre-wrap; white-space: pre;">check box not checked, I agree to the terms and conditions, link, Terms and conditions<br /></code></pre><div style="margin: 0px 0px 1.2em ! important;">Ug. That’s horrible. In contrast, this is what we get in Firefox (where the label isn’t stripped):</div><pre style="font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; font-size: 1em; line-height: 1.2em; margin: 1.2em 0px;"><code style="background-color: #f8f8f8; border-radius: 3px; border-radius: 3px; border: 1px solid rgb(204, 204, 204); border: 1px solid rgb(234, 234, 234); display: block ! important; display: inline; font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; margin: 0px 0.15em; overflow: auto; padding: 0.5em 0.7em; padding: 0px 0.3em; white-space: pre-wrap; white-space: pre;">check box not checked, I agree to the, link, Terms and conditions<br /></code></pre><div style="margin: 0px 0px 1.2em ! important;">Ignoring the label element means we also lose its original position  relative to other content. Particularly in tables, this can be really  important, since the position of the label in the table might very much  help you to understand the structure of the form or aid in navigation of  the table.</div><h4 id="fine-so-use-the-label-element-and-ignore-the-name-of-the-check-box-" style="font-size: 1.2em; font-weight: bold; margin: 1.3em 0px 1em; padding: 0px;">Fine. So use the label element and ignore the name of the check box.</h4><div style="margin: 0px 0px 1.2em ! important;">Great. You just broke this example:</div><pre style="font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; font-size: 1em; line-height: 1.2em; margin: 1.2em 0px;"><code style="background-color: #f8f8f8; border-radius: 3px; border-radius: 3px; border: 1px solid rgb(204, 204, 204); border: 1px solid rgb(234, 234, 234); display: block ! important; display: inline; font-family: Consolas,Inconsolata,Courier,monospace; font-size: 0.85em; margin: 0px 0.15em; overflow: auto; padding: 0.5em 0.7em; padding: 0px 0.3em; white-space: pre-wrap; white-space: pre;">&lt;div role="checkbox" aria-label="Muahahaha"&gt;&amp;nbsp;&lt;/div&gt;<br /></code></pre><h4 id="make-up-your-mind-" style="font-size: 1.2em; font-weight: bold; margin: 1.3em 0px 1em; padding: 0px;">Make up your mind!</h4><div style="margin: 0px 0px 1.2em ! important;">I know, right? The problem is that both of these suck.</div><div style="margin: 0px 0px 1.2em ! important;">The solution I eventually implemented in NVDA is that for check boxes and  radio buttons, if the label is invisible, we do render the name as the  content for the check box. Finally, another solid rule.</div><h4 id="sweet-and-this-applies-to-other-form-controls-too-yeah-" style="font-size: 1.2em; font-weight: bold; margin: 1.3em 0px 1em; padding: 0px;">Sweet! And this applies to other form controls too, yeah?</h4><div style="margin: 0px 0px 1.2em ! important;">Alas, no. The trouble with other form controls like text boxes, list  boxes, combo boxes, sliders, etc. is that their label could never be  considered their “content”. Their content is the actual stuff entered  into the control; e.g. the text typed into a text box.</div><div style="margin: 0px 0px 1.2em ! important;">If the label is visible, it’s easy: we render the label element and  ignore the name of the control. If it isn’t visible, currently, NVDA  browse mode doesn’t present it at all.</div><div style="margin: 0px 0px 1.2em ! important;">To solve this, we need to present the label separately. For a flat  document representation such as NVDA browse mode, this is tricky, since  the label isn’t the “content” of anything. I think the best solution for  NVDA here is to present the name of the control as meta information,  but only if the label isn’t visible. I haven’t yet implemented this.</div><h4 id="rocking-can-the-label-override-the-content-for-divs-spans-and-table-cells-" style="font-size: 1.2em; font-weight: bold; margin: 1.3em 0px 1em; padding: 0px;">Rocking. Can the label override the content for divs, spans and table cells?</h4><div style="margin: 0px 0px 1.2em ! important;">No, because if it did, again, we’d lose formatting and semantic info.  These elements in particular can contain just about any amount of  anything. Do we really want to risk losing that much formatting/info?  See the Twitter example above for just a taste of what we might lose.</div><div style="margin: 0px 0px 1.2em ! important;">Another problem with this is the title attribute. Remember I mentioned  that aria-label/ledby just alters what the browser exposes as the  “name”? The problem is that other things can be exposed as the name,  too. If there is no other name, the title attribute will be used if  present. I’d say it’s quite likely that the title attribute has been  used on quite a lot of divs and spans in the wild, perhaps even table  cells. If we replaced the content in this case, that would be… rather  unfortunate.</div><div style="margin: 0px 0px 1.2em ! important;"><a href="https://github.com/nvaccess/nvda/issues/5567#issuecomment-161286094">Some have argued that for table cells, we should at least append the aria-label/ledby</a>.  Aside from the nasty duplication that might result, this raises a new  category of use cases: those where the label should be appended to the  content, not overide it. With a new category begin the same questions:  what are the rules for this category? And would this make sense for all  use cases? It certainly seems sketchy to me, and sketchy just isn’t okay  here. Again, we need solid, unambiguous rules.</div><h4 id="stop-stop-i-just-can-t-take-it-any-more-" style="font-size: 1.2em; font-weight: bold; margin: 1.3em 0px 1em; padding: 0px;">Stop! Stop! I just can’t take it any more!</h4><div style="margin: 0px 0px 1.2em ! important;">Yeah, I hear you. Welcome to my pain! But seriously, I hope this has  given some insight into why this stuff is so complicated. It seems so  simple when you consider a few use cases, but that simplicity starts to  fall apart once you dig a little deeper. Trying to produce “common  sense” behaviour for the multitude of use cases becomes extremely  difficult, if not downright impossible.</div><div style="margin: 0px 0px 1.2em ! important;">If we want interoperability, we need solid rules. I’m not necessarily  suggesting that this be compulsory or prescriptive; different AT  products have different interaction models and we also need to allow for  preferences and innovation. Right now, though, there’s absolutely  nothing.</div></div>
